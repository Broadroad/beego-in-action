7. 应用配置
=========

在上一章 [数据库和 ORM](06.数据库.md) 中, 我们需要使用到数据库的连接信息, 以及可能需要根据环境来配置是用不同的数据库. 
这些信息有些是重要的敏感信息, 有些是根据环境的不同而不同的动态信息. 
对于这些信息, 为了安全和方便, 我们要尽量避免将它们写死在项目中, 更要避免将这些信息提交到代码管理库中.
通常我们会根据环境的不同而生成这些配置信息, 通过配置文件或者环境变量的方式提供这些配置信息.

# config 模块

为了解决这种需求, `beego` 提供了 [config 模块][1].

```go
import (
    "github.com/astaxie/beego/config"
)

const (
	dbConfigPath  string = "conf/db.conf"
    defaultDbName string = "beefer"
)

dbConfig, err := config.NewConfig("ini", dbConfigPath)
db := dbConfig.String("db")
dbName := dbConfig.DefaultString("db_name", defaultDbName)
```

本段代码的 [commit][2]

首先引入 `github.com/astaxie/beego/config`, 然后通过 `config.NewConfig("ini", dbConfigPath)` 将 `ini` 文件 `dbConfPath` 中的配置信息读入到变量 `dbConfig` 中.
除了 `ini` 文件, `config 模块` 还支持 `json`、`xml`、`yaml` 格式.

接着我们便可以通过 `dbConfig.String("db")` 来读取配置文件中的配置项. 

我们还可以使用 `dbConfig.DefaultString("db_name", defaultDbName)`, 如果没有该配置项, 则返回默认值 `defaultDbName`.

`ini` 类型的配置文件还支持通过 `[section::key]` 的方式来获取一个段落下的配置, 例如通过 `	dbUser := dbConfig.String("sqlite3::db_name")` 来获取:
  
```ini
[sqlite3]
db_name = ./db/beefer.db
```

除了 `String()`, `config` 模式还支持其他方法, 比如 `Int()`, `Bool()`, `DIY()`, 具体请参见[文档][1].


## 配置文件

上面的例子中设置了 `conf/db.conf` 来存放数据库配置信息. 
同样, 我们还要避免将存有敏感信息的文件提交到代码库中, 因此我们在 `.gitignore` 中排除掉该文件, 并将保存有空的配置信息的模板 `conf/_db.conf`提交到代码库中.
在不同的环境中, 我们只需要拷贝 `conf/_db.conf` 为 `conf/db.conf` 并配置相应的信息就可以了.

本段代码的 [commit][3]

[1]: http://beego.me/docs/module/config.md
[2]: https://github.com/lei-cao/beefer/commit/a894b6f000cb4fb2654a41bf99666e75801b9d98
[3]: https://github.com/lei-cao/beefer/commit/abe237f80b57935910b72458b79c97c8a560ddcc
